<app-header/>
<section class="product-detail">
    <div class="container">
        <div class="product-container">
            <div class="row">
                <div class="col-lg-6 col-md-4 p-3">
                    <div id="productCarousel" class="carousel slide"
                        data-ride="carousel">
                        <div class="carousel-inner">
                            @for (image of productDetail?.images; track $index) {
                                <div class="carousel-item" 
                                    [ngClass]="{'active' : image.is_thumbnail === true}">
                                    <img [src]="image.image_url"
                                        class="d-block w-100 carousel-img"
                                        alt="Main Product Image">
                                </div>
                            }
                        </div>
                        <button class="carousel-control-prev" type="button"
                            data-bs-target="#productCarousel"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon"
                                aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button"
                            data-bs-target="#productCarousel"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon"
                                aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>

                    <div class="d-flex justify-content-center mt-3">
                        @for (image of productDetail?.images; track $index) {
                            <div class="thumbnail" data-bs-target="#productCarousel"
                            [attr.data-bs-slide-to]="$index">
                                <img [src]="image.image_url"
                                    class="img-thumbnail thumbnail-img"
                                    [alt]="image.image_url">
                            </div>
                        }
                    </div>
                </div>

                <div class="col-lg-6 col-md-8 p-3">
                    <div *ngIf="productDetail">

                      <div class="product-details">

                        <div class="row">
                            <h2 class="heading-secondary">{{ productDetail.name }}</h2>
                            <span class="detail-price mt-2"><strong>{{ formatCurrency( productDetail.price) }}</strong></span>
                        </div>

                        @if (productDetail.promotion_codes.length > 0) {
                            <div class="row mt-3">
                                <div class="col-3">
                                    <span class="detail-heading">Mã giảm giá của shop</span>
                                </div>
    
                                <div class="col-9">
                                    <ul class="voucher-list">
                                        @for (promotion of productDetail.promotion_codes; track $index) {
                                            <li class="voucher-item">
                                                Giảm {{formatDiscount(
                                                    promotion.code_discount_value, 
                                                    promotion.discount_type)
                                                    }}
                                            </li>
                                        }
                                    </ul>
                                </div>
                            </div>
                        }

                        <div class="row mt-3">
                            <div class="col-3">
                                <span class="detail-heading">Các loại phương thức vận chuyển</span>
                            </div>

                            <div class="col-9">
                                <div class="shipping-method mt-4">
                                    <p>
                                        <ng-icon name="bootstrapTruck"></ng-icon> 
                                        Phương thức vận chuyển</p>
                                    <ul class="shipping-list">
                                        <li><strong>Express:</strong> Giao hàng nhanh trong vòng 1-2 ngày</li>
                                        <li><strong>Standard:</strong> Giao hàng trong 3-5 ngày</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                  
                        <div class="row mt-4">
                          <div class="col-3 mt-2">
                            <span class="detail-heading">Số lượng</span>
                          </div>
                          <div class="col-9">
                            <div class="quantity-control">
                              <button class="decrement" (click)="changeQuantity(-1)" [disabled]="quantity <= 1">-</button>
                              <input type="number" [(ngModel)]="quantity" disabled/>
                              <button class="increment" (click)="changeQuantity(1)">+</button>
                              <span class="availability mt-2">{{ productDetail.stock_quantity }} sản phẩm có sẵn</span>
                            </div>
                          </div>
                        </div>
                  
                        <div class="btn-purchase-action mt-4">
                          <button class="btn-cart" (click)="addCart(productDetail.id)">
                            <ng-icon name="bootstrapCartPlus"></ng-icon>
                            <span>Thêm vào giỏ hàng</span>
                          </button>
                          <button class="btn-buy" (click)="buyNow(productDetail.id)">Mua ngay</button>
                        </div>
                      </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="store-info">

            <div class="store-header">
                <img [src]="productDetail?.seller_info?.image_url" 
                    [alt]="productDetail?.seller_info?.store_name"
                    class="store-logo">
                <div class="store-details">
                    <h2>{{productDetail?.seller_info?.store_name}}</h2>
                    <button class="chat-button">Chat Ngay</button>
                    <button class="view-store-button">Xem Shop</button>
                </div>
            </div>

            <div class="store-contact">
                <p><strong>Điện thoại:</strong> {{productDetail?.seller_info?.phone_number}}</p>
                <p><strong>Email:</strong> {{productDetail?.seller_info?.email}}</p>
            </div>

            <div class="store-stats">
                <div class="stat">
                    <span class="label">Đánh Giá</span>
                    <span class="value">{{productDetail?.seller_info?.total_reviews}}</span>
                </div>
                <div class="stat">
                    <span class="label">Sản Phẩm</span>
                    <span class="value">{{productDetail?.seller_info?.total_products_sold}}</span>
                </div>
                <div class="stat">
                    <span class="label">Tham Gia</span>
                    <span class="value">6 năm trước</span>
                </div>
            </div>

        </div>

        <ul class="nav nav-tabs mt-5" id="productTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="description-tab" data-bs-toggle="tab" 
                    data-bs-target="#description" type="button" role="tab" 
                    aria-controls="description" aria-selected="true">
                    Mô tả sản phẩm
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="recommend-tab" data-bs-toggle="tab" 
                    data-bs-target="#recommend" type="button" role="tab" 
                    aria-controls="recommend" aria-selected="false"
                    (click)="getProductRecommend()">
                    Sản phẩm gợi ý
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reviews-tab" data-bs-toggle="tab" 
                    data-bs-target="#reviews" type="button" role="tab" 
                    aria-controls="reviews" aria-selected="false">
                    Đánh giá
                </button>
            </li>
        </ul>

        <div class="tab-content" id="productTabContent">
            <!-- Mô tả sản phẩm -->
            <div class="tab-pane fade show active" id="description" 
                role="tabpanel" aria-labelledby="description-tab">
                <div class="mt-3">
                    <h3 class="heading-secondary">Mô tả sản phẩm</h3>
                    <p [innerHTML]="productDetail?.description"></p>
                </div>
            </div>

            <!-- Sản phẩm gợi ý -->
            <div class="tab-pane fade" id="recommend" role="tabpanel" 
                aria-labelledby="recommend-tab">
                <div class="mt-3">
                    <h3 class="heading-secondary">Sản phẩm gợi ý</h3>
                    <div class="row">
                        @if(productRecommend) {
                            @for (product of productRecommend; track $index) {
                                <div class="col-md-3">
                                    <div class="card">
                                        <img [src]="product.thumbnail == null 
                                            ? 'assets/images/img-hero.png' : product.thumbnail"
                                            class="card-img-top"
                                            [alt]="product.name">
                                        <div class="card-body">
                                            <h5 class="card-title">{{ product.name }}</h5>
                                            <p class="card-text">{{ formatCurrency(product.price) }}</p>
                                            <a href="#" class="btn btn-primary">Xem chi tiết</a>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    </div>
                </div>
            </div>

            <!-- Đánh giá -->
            <div class="tab-pane fade" id="reviews" role="tabpanel" 
                aria-labelledby="reviews-tab">
                <div class="mt-3">
                    <h3 class="heading-secondary">Đánh giá sản phẩm</h3>
                    <p><strong>Đánh giá trung bình:</strong> ★★★★☆ (4.5/5)</p>
                    <p>"Sản phẩm tuyệt vời, chất lượng tốt!" - Khách hàng A</p>
                    <p>"Tôi rất hài lòng với sản phẩm này." - Khách hàng B</p>
                    <p><a href="#">Xem thêm đánh giá</a></p>
                </div>
            </div>
        </div>
    </div>
</section>
<app-footer/>